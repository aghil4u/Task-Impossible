@model iTask

@{
    ViewData["Title"] = "Create";
    Layout = "_LayoutWizard";
}


<link href="~/css/dropzone.css" rel="stylesheet"/>


<!-- Big container -->
<div class="container">
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2">
            <!-- Wizard container -->
            <div class="wizard-container">
                <div class="card wizard-card" data-color="purple" id="wizard">
                    <form asp-controller="Tasks" asp-action="Create" novalidate="novalidate">

                        <div class="wizard-header">
                            <h3 class="wizard-title">
                                Create A Task
                            </h3>
                            <h5>Let us walk you through this.</h5>
                        </div>
                        <div class="wizard-navigation">
                            <ul class="nav nav-pills">
                                <li class="active" style="width: 25%;">
                                    <a href="#tasktitle" data-toggle="tab" aria-expanded="true">TITLE</a>
                                </li>
                                <li class="" style="width: 25%;">
                                    <a href="#type" data-toggle="tab" aria-expanded="false">DETAILS</a>
                                </li>
                                <li class="" style="width: 25%;">
                                    <a href="#fileUploadTab" data-toggle="tab" aria-expanded="false">Images</a>
                                </li>

                                <li style="width: 25%;">
                                    <a href="#loc" id="maptab" data-toggle="tab">Location</a>
                                </li>
                                <li style="width: 25%;">
                                    <a href="#description" data-toggle="tab">Renumeration</a>
                                </li>
                                <li style="width: 25%;">
                                    <a href="#last" data-toggle="tab">Finish</a>
                                </li>
                            </ul>
                            <div class="moving-tab" style="transform: translate3d(-8px, 0px, 0px); transition: all 0.5s cubic-bezier(0.29, 1.42, 0.79, 1); width: 187.5px;">Title</div>
                        </div>

                        <div class="tab-content">
                            <div class="tab-pane active" id="tasktitle">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <h4 class="info-text"> In Short.</h4>
                                    </div>
                                    <div class="col-sm-8 col-sm-offset-2" style="margin-top: 2rem">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">I want a Tasker to...</label>
                                            <input type="text" class="form-control" asp-for="Title" id="tasktitlefield">

                                        </div>

                                        <div class="row" style="margin-bottom: 5rem; text-align: center;">
                                            <div class="btn-group bootstrap-select show-tick" id="dtselector" style="display: inline-block; width: fit-content;">
                                                <select class="selectpicker" data-style="select-with-transition" name="DatePretext" data-size="7" tabindex="-98" style="text-transform: lowercase">
                                                    <option value="1">On </option>
                                                    <option value="2">Before</option>
                                                    <option value="3">After</option>
                                                    <option value="4">From</option>
                                                </select>

                                            </div>


                                            <div class="form-group" style="display: inline-block;" id="fromDateSelector">
                                                <input type="datetime" asp-for="StartDate" placeholder="Start Date" class="form-control datetimepicker" style="text-align: center; width: fit-content">

                                            </div>

                                            <div class="btn-group bootstrap-select show-tick hidegroup" id="etselector" style="display: inline-block; width: fit-content;">
                                                <select class="selectpicker" data-style="select-with-transition" data-size="7" tabindex="-98" style="text-transform: lowercase">
                                                    <option value="1">To </option>
                                                    <option value="2">Until Unknown</option>
                                                    <option value="3">For Ever</option>

                                                </select>
                                            </div>


                                            <div class="form-group hidegroup" style="display: inline-block;" id="todateselector">

                                                <input type="datetime" asp-for="EndDate" value="@DateTime.Now" placeholder="End Date" class="form-control datetimepicker">
                                                <span class="material-input"></span>
                                            </div>
                                        </div>

                                    </div>


                                </div>
                            </div>


                            <div class="tab-pane" id="type">
                                <h4 class="info-text">Give us some details. </h4>
                                <div class="row" style="margin-top: -2rem;">
                                    <div class="col-sm-10 col-sm-offset-1">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Task description</label>
                                            <textarea class="form-control" asp-for="Description" placeholder="" rows="9"></textarea>
                                            <span class="material-input"></span>
                                            <span class="material-input"></span>
                                        </div>
                                    </div>


                                </div>

                            </div>


                            <div class="tab-pane" id="loc"style="margin-left: -15px; margin-right: -15px;">
                                <h4 class="info-text"> Show us the location of the task. </h4>

                                <div class="row">
                                    <div class="col-sm-12">

                                        <div id="map" class="big-map" style="height: 300px; width: 100%;"></div>

                                        <div class="form-group" style="margin-left: 5rem; margin-right: 5rem; margin-top: -5px;">
                                            <input type="text" id="locText" asp-for="Location" class="form-control">
                                            <input type="text" id="lat-box" asp-for="Lat" class="form-control hidden">
                                            <input type="text" id="lon-box" asp-for="Lon" class="form-control hidden">
                                            <input type="hidden" id="CoverPhoto" asp-for="CoverPhoto" class="form-control">
                                            <span class="material-input"></span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="tab-pane" id="description">
                                <div class="row">
                                    <h4 class="info-text"> Tell us about your Budget. </h4>
                                    <div class="col-sm-8 col-sm-offset-2" style="margin-top: 5rem">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Im Ready to Pay...</label>
                                            <input type="text" class="form-control" asp-for="Renumeration">
                                            <span class="material-input"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="fileUploadTab">
                                <div class="row">
                                    <h4 class="info-text"> Tell us about your Budget. </h4>
                                    <div class="col-sm-12">


                                        <div id="dropzone" style="height: 300px; margin: -1rem;">
                                            <div class="dropzone" id="dropzoneForm" style="height: 100%">
                                                <div class="fallback">
                                                    <input name="file" type="file" multiple/>
                                                    <input type="submit" value="Upload"/>
                                                </div>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="last">
                                <div class="row">
                                    <h4 class="info-text"> Review your Task Listing. </h4>
                                    <div class="col-sm-6 col-sm-offset-1">
                                        <div class="form-group label-floating is-empty">
                                            <label class="control-label">Place description</label>
                                            <textarea class="form-control" placeholder="" rows="9"></textarea>
                                            <span class="material-input"></span>
                                        </div>
                                    </div>
                                    <div class="col-sm-4">
                                        <div class="form-group label-floating">
                                            <label class="control-label">Example</label>
                                            <p class="description">"The place is really nice. We use it every sunday when we go fishing. It is so awesome."</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wizard-footer">
                            <div class="pull-right">
                                <input type="button" class="btn btn-next btn-fill btn-primary btn-wd" name="next" value="Next">
                                <input type="submit" class="btn btn-finish btn-fill btn-primary btn-wd" name="finish" value="Finish" style="display: none;">
                            </div>
                            <div class="pull-left">
                                <input type="button" class="btn btn-previous btn-fill btn-default btn-wd disabled" name="previous" value="Previous">
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </form>
                </div>
            </div> <!-- wizard container -->
        </div>
    </div> <!-- row -->
</div> <!-- big container -->

<div class="footer">
    <div class="container text-center">
        Made with <i class="fa fa-heart heart"></i> by <a href="http://www.idkw.im"> The Impossible Team</a>.
    </div>
</div>


<script src="~/js/dropzone.js"></script>
<script type="text/javascript">
    //File Upload response from the server
    Dropzone.options.dropzoneForm = {
        maxFiles: 10,
        url: "UploadFile",
        addRemoveLinks: "True",
        resizeWidth: 1080,
        init: function() {
            this.on("maxfilesexceeded",
                function(data) {
                    var res = eval('(' + data.xhr.responseText + ')');
                });
            this.on("addedfile",
                function(file) {

                });
            this.on("success",
                function(data) {
                    if ($("#CoverPhoto").val() == "") {
                        document.getElementById("CoverPhoto").value = data.xhr.response;
                        console.log(data.xhr.response);

                    }
                    document.getElementById("CoverPhoto").value = data.xhr.response.replace(/['"]+/g, '');

                });
        }
    };


</script>


<script>


    $(document).ready(function() {

        materialKit.initFormExtendedDatetimepickers();

        //DATE SELECTOR SHOW AND HIDE BASED ON SELECTOR
        $('.hidegroup').hide();
        $('#todateselector').datetimepicker({ useCurrent: true });

        $('#dtselector').on('change',
            function() {
                var selected = $(this).find("option:selected").val();
                $("#DatePretext").val($(this).text());
                if (selected < 4) {

                    $('.hidegroup').hide();
                    $('#todateselector').datetimepicker({ useCurrent: true });
                } else {
                    $('.hidegroup').show();

                }


            });

        $('#etselector').on('change',
            function() {
                var selected = $(this).find("option:selected").val();
                if (selected == 1) {

                    $('#todateselector').show();

                } else {
                    $('#todateselector').hide();
                    $('#todateselector').datetimepicker({ useCurrent: true });

                }


            });


    });


    //MAP WORKS
    var map, pos, marker;

    function initMap() {

        pos = { lat: -34.397, lng: 150.644 };
        map = new google.maps.Map(document.getElementById('map'),
            {
                center: pos,
                zoom: 10,
                zoomControl: true,
                mapTypeControl: false,
                scaleControl: false,
                streetViewControl: false,
                rotateControl: false,
                fullscreenControl: true,
                geolocationControl: true
            });
        marker = new google.maps.Marker({
            map: map,
            position: pos,
            title: "{{ location.name }}",
            draggable: true,
        });
        marker.setMap(map);
        //marker.addListener('drag', handleDragEvent);
        marker.addListener('dragend', handleDragEvent);

        BindResizeEvent();


        // Try HTML5 geolocation.
        if (navigator.geolocation) {

            navigator.geolocation.getCurrentPosition(function(position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                marker = new google.maps.Marker({
                    map: map,
                    position: pos,
                    title: "{{ location.name }}",
                    draggable: true,
                });
                //marker.addListener('drag', handleDragEvent);
                marker.addListener('dragend', handleDragEvent);
                marker.setMap(map);
                map.setCenter(pos);
            });

        }
    }


    function handleDragEvent(event) {
        var geocoder = new google.maps.Geocoder;
        geocoder.geocode({ 'location': event.latLng },
            function(results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        document.getElementById('locText').value = results[0].formatted_address;
                    } else {
                        document.getElementById('locText').value = event.latLng.lat() + "   " + event.latLng.lng();
                    }

                } else {
                    document.getElementById('locText').value = event.latLng.lat() + "   " + event.latLng.lng();
                }

                document.getElementById('lat-box').value = event.latLng.lat();
                document.getElementById('lon-box').value = event.latLng.lng();

            });
    }


    function BindResizeEvent() {
        $("a[href='#loc']").on('shown.bs.tab',
            function() {
                google.maps.event.trigger(map, 'resize');
                map.setCenter(pos);
            });
    }
</script>


<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbzz2gsUhD2YunQ0oZC4dQAw8XCG1E8tQ&callback=initMap">
</script>